---
import { getCollection } from 'astro:content';

// Top-level await - this is the key trigger for the circular dependency bug.
// When combined with SVG images in content collection image() fields,
// the TLA causes a module evaluation deadlock.
const articles = await getCollection('articles');
---
<html>
  <head>
    <title>Articles</title>
  </head>
  <body>
    {articles.map((article) => {
      const Cover = article.data.cover;
      return (
        <div class="article">
          <h2 class="title">{article.data.title}</h2>
          <img class="cover" src={article.data.cover.src} width={article.data.cover.width} height={article.data.cover.height} />
          <Cover class="inline-svg" />
        </div>
      );
    })}
  </body>
</html>
